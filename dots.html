<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Capital Conquest ‚Äì Advanced Map</title>
<style>
body {
    background:#0e1111;
    color:white;
    font-family:Arial;
    text-align:center;
}
canvas {
    border:2px solid #333;
    background:#2f4f3a;
}
button {
    margin:4px;
    padding:8px 12px;
}
</style>
</head>
<body>

<h2>üåç Capital Conquest</h2>

<canvas id="map" width="900" height="450"></canvas>

<div>
    <button onclick="declareWar()">Declare War</button><br>
    <button onclick="advance('charge')">Charge</button>
    <button onclick="advance('normal')">Normal</button>
    <button onclick="advance('tricky')">Tricky</button>
    <button onclick="advance('encircle')">Encircle</button><br>
    <button onclick="peace()">Peace (Edit Border)</button>
</div>

<p id="info"></p>

<script>
const canvas = document.getElementById("map");
const ctx = canvas.getContext("2d");

let atWar = false;
let trickyUses = 0;
let enemyStrength = 1;

// Capitals
const blueCapital = {x:120,y:225};
const redCapital = {x:780,y:225};

// Curvy border (control points)
let borderPoints = [
    {x:450,y:50},
    {x:430,y:225},
    {x:450,y:400}
];

let draggingPoint = null;
let peaceMode = false;

// Units
let userDots = Array.from({length:12},()=>({x:200+Math.random()*60,y:60+Math.random()*320}));
let enemyDots = Array.from({length:12},()=>({x:650+Math.random()*60,y:60+Math.random()*320}));

function declareWar(){
    atWar=true;
    peaceMode=false;
    info("‚öîÔ∏è War declared");
}

function advance(type){
    if(!atWar) return;

    let successChance=0.5, shift=20;

    if(type==="charge"){successChance=0.4; shift=40;}
    if(type==="normal"){successChance=0.55; shift=20;}
    if(type==="tricky"){
        successChance=Math.max(0.7 - trickyUses*0.1,0.3);
        trickyUses++;
        shift=15;
    }
    if(type==="encircle"){
        successChance=0.3;
        shift=60;
    }

    if(Math.random()<successChance){
        borderPoints.forEach(p=>p.x+=shift);
        userDots.forEach(d=>d.x+=shift*0.5);
        if(type==="encircle"){
            enemyDots.splice(0,Math.floor(enemyDots.length/2));
            enemyStrength*=0.7;
        }
        info("Advance succeeded");
    } else {
        borderPoints.forEach(p=>p.x-=shift*0.6);
        userDots.forEach(d=>d.x-=shift*0.3);
        info("Advance failed");
    }

    draw();
}

function peace(){
    atWar=false;
    peaceMode=true;
    info("üïäÔ∏è Peace ‚Äì Drag border points");
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Earth-like texture
    ctx.fillStyle="#3c6e47";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // Territories
    drawTerritory("rgba(40,80,200,0.35)",true);
    drawTerritory("rgba(200,40,40,0.35)",false);

    // Border
    drawBorder();

    // Capitals
    drawDot(blueCapital.x,blueCapital.y,"yellow",8);
    drawDot(redCapital.x,redCapital.y,"yellow",8);

    // Units
    userDots.forEach(d=>drawDot(d.x,d.y,"cyan",5));
    enemyDots.forEach(d=>drawDot(d.x,d.y,"red",5));

    // Peace edit points
    if(peaceMode){
        borderPoints.forEach(p=>drawDot(p.x,p.y,"white",6));
    }
}

function drawTerritory(color,isBlue){
    ctx.beginPath();
    ctx.moveTo(isBlue?0:canvas.width,0);
    ctx.lineTo(isBlue?borderPoints[0].x:borderPoints[0].x,0);
    ctx.bezierCurveTo(
        borderPoints[0].x,borderPoints[0].y,
        borderPoints[1].x,borderPoints[1].y,
        borderPoints[2].x,borderPoints[2].y
    );
    ctx.lineTo(isBlue?0:canvas.width,canvas.height);
    ctx.closePath();
    ctx.fillStyle=color;
    ctx.fill();
}

function drawBorder(){
    ctx.strokeStyle="white";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(borderPoints[0].x,0);
    ctx.bezierCurveTo(
        borderPoints[0].x,borderPoints[0].y,
        borderPoints[1].x,borderPoints[1].y,
        borderPoints[2].x,canvas.height
    );
    ctx.stroke();
}

function drawDot(x,y,color,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fillStyle=color;
    ctx.fill();
}

canvas.addEventListener("mousedown",e=>{
    if(!peaceMode) return;
    const r=canvas.getBoundingClientRect();
    const mx=e.clientX-r.left;
    const my=e.clientY-r.top;
    borderPoints.forEach(p=>{
        if(Math.hypot(p.x-mx,p.y-my)<10) draggingPoint=p;
    });
});

canvas.addEventListener("mousemove",e=>{
    if(!draggingPoint) return;
    const r=canvas.getBoundingClientRect();
    draggingPoint.x=e.clientX-r.left;
    draggingPoint.y=e.clientY-r.top;
    draw();
});

canvas.addEventListener("mouseup",()=>draggingPoint=null);

function info(msg){
    document.getElementById("info").innerText=msg;
}

draw();
</script>

</body>
</html>
