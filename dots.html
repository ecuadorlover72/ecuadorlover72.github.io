<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Capital Conquest</title>
<style>
body {
    background:#0b0f0f;
    color:white;
    font-family:Arial;
    text-align:center;
}
canvas {
    border:2px solid #222;
    background:#264c3b;
}
button {
    padding:6px 10px;
    margin:4px;
}
#panel {
    margin-top:10px;
}
</style>
</head>

<body>

<h2>üåç Capital Conquest</h2>

<div id="start">
    <input id="nameInput" placeholder="Your Nation Name">
    <button onclick="start()">Start Game</button>
</div>

<p id="info"></p>

<canvas id="map" width="900" height="450"></canvas>

<div id="panel">
    <button onclick="declareWar()">Declare War</button>
    <button onclick="advance('charge')">Charge</button>
    <button onclick="advance('normal')">Normal</button>
    <button onclick="advance('tricky')">Tricky</button>
    <button onclick="advance('encircle')">Encircle</button><br>
    <button onclick="openPeace()">Peace</button>
    <button onclick="recruit()">Recruit Army (üí∞10)</button>
</div>

<script>
const canvas=document.getElementById("map");
const ctx=canvas.getContext("2d");

let player="Blue State";
let ai="Red Dominion";
let atWar=false;
let peaceMode=false;
let peaceChoice=null;

let money=20, aiMoney=20;
let army=20, aiArmy=20;
let trickyUses=0;

const blueCapital={x:120,y:225};
const redCapital={x:780,y:225};

let border=[
    {x:450,y:0},
    {x:430,y:150},
    {x:450,y:300},
    {x:440,y:450}
];

let dragging=null;

function start(){
    player=document.getElementById("nameInput").value||"Blue State";
    document.getElementById("start").style.display="none";
    draw();
}

function declareWar(){atWar=true; peaceMode=false; updateInfo("‚öî War");}
function openPeace(){
    atWar=false;
    peaceMode=true;
    money+=5;
    updateInfo("üïä Peace ‚Äì Choose Border or Money");
}

function recruit(){
    if(money>=10){
        money-=10;
        army+=5;
    }
    draw();
}

function advance(type){
    if(!atWar) return;

    let base=army/(army+aiArmy);
    let chance=base;
    let shift=20;

    if(type==="charge"){chance-=0.15; shift=40;}
    if(type==="normal"){shift=25;}
    if(type==="tricky"){
        chance+=0.2-trickyUses*0.1;
        trickyUses++;
        shift=20;
    }
    if(type==="encircle"){chance-=0.25; shift=55;}

    if(Math.random()<chance){
        border.forEach(p=>p.x+=shift);
        aiArmy=Math.max(5,aiArmy-5);
    }else{
        border.forEach(p=>p.x-=shift*0.7);
        army=Math.max(5,army-5);
    }

    aiPeaceAttempt();
    checkWin();
    draw();
}

function aiPeaceAttempt(){
    if(Math.random()<0.2){
        atWar=false;
        peaceMode=true;
        updateInfo("AI offers peace!");
    }
}

function checkWin(){
    if(border.some(p=>p.x>=redCapital.x)){
        alert(player+" wins!");
        location.reload();
    }
    if(border.some(p=>p.x<=blueCapital.x)){
        alert(ai+" wins!");
        location.reload();
    }
}

function updateInfo(msg){
    document.getElementById("info").innerText=
    `${player} | Army:${army} Money:${money} vs ${ai} | Army:${aiArmy} | ${msg||""}`;
}

function draw(){
    ctx.clearRect(0,0,900,450);

    // Earth texture
    for(let i=0;i<900;i+=4){
        for(let j=0;j<450;j+=4){
            ctx.fillStyle=`rgb(30,${80+Math.random()*40},40)`;
            ctx.fillRect(i,j,4,4);
        }
    }

    drawTerritory("rgba(50,100,220,0.35)",true);
    drawTerritory("rgba(220,60,60,0.35)",false);
    drawBorder();

    drawDot(blueCapital.x,blueCapital.y,"yellow",8);
    drawDot(redCapital.x,redCapital.y,"yellow",8);

    updateInfo();
}

function drawTerritory(color,left){
    ctx.beginPath();
    ctx.moveTo(left?0:900,0);
    border.forEach(p=>ctx.lineTo(p.x,p.y));
    ctx.lineTo(left?0:900,450);
    ctx.closePath();
    ctx.fillStyle=color;
    ctx.fill();
}

function drawBorder(){
    ctx.strokeStyle="white";
    ctx.lineWidth=2;
    ctx.beginPath();
    ctx.moveTo(border[0].x,0);
    border.forEach(p=>ctx.lineTo(p.x,p.y));
    ctx.stroke();

    if(peaceMode){
        border.forEach(p=>drawDot(p.x,p.y,"white",6));
    }
}

function drawDot(x,y,c,r){
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fillStyle=c;
    ctx.fill();
}

canvas.onmousedown=e=>{
    if(!peaceMode) return;
    const r=canvas.getBoundingClientRect();
    const x=e.clientX-r.left, y=e.clientY-r.top;
    border.forEach(p=>{
        if(Math.hypot(p.x-x,p.y-y)<10) dragging=p;
    });
};

canvas.onmousemove=e=>{
    if(!dragging) return;
    const r=canvas.getBoundingClientRect();
    dragging.x=e.clientX-r.left;
    dragging.y=e.clientY-r.top;
    draw();
};

canvas.onmouseup=()=>dragging=null;

draw();
</script>

</body>
</html>
