<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Esports Country Guessing Game</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
/* ---------- GENERAL ---------- */
html, body {
    margin: 0;
    height: 100%;
    font-family: "Orbitron", Arial, sans-serif;
    background: #0a0a0a;
    color: #ffffff;
    overflow: hidden;
}
#map {
    height: 100%;
    transition: margin-bottom 0.3s;
}

/* ---------- HUD BAR BOTTOM ---------- */
#hud-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 140px;
    background: rgba(10,10,10,0.95);
    border-top: 2px solid #ff00ff;
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 10px 20px;
    box-sizing: border-box;
    z-index: 1000;
    backdrop-filter: blur(6px);
}
#stats-panel, #xp-panel, #timer-panel {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #00ffff;
    font-weight: bold;
}
#stats-panel span, #xp-panel span, #timer-panel span {
    font-size: 14px;
}

/* ---------- ACHIEVEMENT POPUP ---------- */
#achievement-popup {
    position: fixed;
    right: 20px;
    top: 20px;
    min-width: 220px;
    padding: 12px 16px;
    background: rgba(20,0,40,0.85);
    border-left: 4px solid #ff00ff;
    border-radius: 8px;
    color: #ffffff;
    font-weight: bold;
    font-size: 14px;
    opacity: 0;
    transform: translateX(150%);
    z-index: 1100;
    display: flex;
    align-items: center;
    gap: 10px;
    pointer-events: none;
}
#achievement-popup.show {
    animation: slideIn 0.7s forwards, fadeOut 0.7s 2.2s forwards;
}
@keyframes slideIn {
    from { transform: translateX(150%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
@keyframes fadeOut {
    from { opacity:1; }
    to { opacity:0; }
}

/* ---------- INPUT ---------- */
#country-input {
    position: fixed;
    bottom: 160px;
    left: 50%;
    transform: translateX(-50%);
    width: 320px;
    padding: 12px 16px;
    border-radius: 12px;
    border: 2px solid #ff00ff;
    background: #120012;
    color: #ffffff;
    font-size: 16px;
    outline: none;
    z-index: 1000;
}
#country-input:focus {
    box-shadow: 0 0 12px #ff00ff;
}

/* ---------- SCORE PANEL ---------- */
#score {
    position: fixed;
    bottom: 310px;
    right: 30px;
    background: rgba(10,10,10,0.85);
    padding: 10px 16px;
    border-left: 4px solid #ff00ff;
    border-radius: 6px;
    font-weight: bold;
    color: #00ffff;
    font-size: 16px;
    z-index: 1000;
}

/* ---------- LISTS PANEL ---------- */
#lists-panel {
    position: fixed;
    top: 20px;
    left: 20px;
    width: 300px;
    max-height: 80%;
    background: rgba(10,10,10,0.85);
    backdrop-filter: blur(6px);
    border: 2px solid #ff00ff;
    border-radius: 12px;
    padding: 14px;
    overflow-y: auto;
    color: #ffffff;
    font-size: 14px;
    z-index: 1000;
}
#lists-panel h3 {
    margin: 6px 0 4px;
    text-transform: uppercase;
    color: #ff00ff;
    font-weight: bold;
}
#lists-panel ul {
    list-style: none;
    padding-left: 6px;
    margin-bottom: 12px;
}
#lists-panel ul li {
    background: #00ffff;
    color: #0a0a0a;
    padding: 4px 6px;
    border-radius: 4px;
    margin: 2px 0;
    font-size: 13px;
}

/* ---------- HEXAGONAL PANEL BACKGROUND ---------- */
.hex-bg {
    background-image: repeating-linear-gradient(
        60deg, 
        rgba(255,0,255,0.05) 0, 
        rgba(255,0,255,0.05) 1px, 
        transparent 1px, 
        transparent 20px
    ), repeating-linear-gradient(
        120deg, 
        rgba(0,255,255,0.05) 0, 
        rgba(0,255,255,0.05) 1px, 
        transparent 1px, 
        transparent 20px
    );
}

/* ---------- GUESS ANIMATION ---------- */
@keyframes guessFlash {
    0% { fill: #ff00ff; fill-opacity: 1; }
    50% { fill: #00ffff; fill-opacity: 0.8; }
    100% { fill: #28a745; fill-opacity: 0.85; }
}

/* ---------- BUTTONS ---------- */
button {
    font-family: "Orbitron", Arial, sans-serif;
    cursor: pointer;
    background: #ff00ff;
    color: #0a0a0a;
    border: none;
    border-radius: 6px;
    padding: 6px 10px;
    font-weight: bold;
    text-transform: uppercase;
    box-shadow: 0 0 8px #ff00ff;
}
button:hover {
    box-shadow: 0 0 14px #ff00ff;
}

/* ---------- RESPONSIVE ---------- */
@media (max-width: 768px) {
    #lists-panel {
        width: 240px;
        font-size: 12px;
    }
    #country-input { width: 260px; }
    #hud-bar { height: 120px; flex-direction: column; gap: 6px; }
}
</style>
</head>
<body>
<!-- MAP -->
<div id="map"></div>

<!-- INPUT -->
<input id="country-input" type="text" placeholder="Type a country...">

<!-- SCORE -->
<div id="score">0/0</div>

<!-- LISTS PANEL -->
<div id="lists-panel" class="hex-bg">
    <h3>Africa</h3><ul id="africa"></ul>
    <h3>Asia</h3><ul id="asia"></ul>
    <h3>Europe</h3><ul id="europe"></ul>
    <h3>North America</h3><ul id="north-america"></ul>
    <h3>South America</h3><ul id="south-america"></ul>
    <h3>Oceania</h3><ul id="oceania"></ul>
</div>

<!-- ACHIEVEMENT POPUP -->
<div id="achievement-popup"></div>

<!-- HUD BAR -->
<div id="hud-bar">
    <div id="stats-panel">
        <span id="stat-correct">Correct: 0</span>
        <span id="stat-total">Total: 0</span>
        <span id="stat-accuracy">Accuracy: 0%</span>
    </div>
    <div id="xp-panel">
        <span>XP</span>
        <div style="width:120px;height:12px;background:#120012;border-radius:6px;margin-top:4px;overflow:hidden;">
            <div id="xp-bar" style="height:100%;width:0%;background:#ff00ff;"></div>
        </div>
        <span id="level">Level 1</span>
    </div>
    <div id="timer-panel">
        <span>Timer</span>
        <span id="timer">00:00</span>
    </div>
</div>

<!-- LIGHTWEIGHT SFX -->
<audio id="sfx-correct"><source src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQgAAAA=" type="audio/wav"></audio>
<audio id="sfx-achievement"><source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQgAAAA=" type="audio/wav"></audio>
<audio id="sfx-timer"><source src="data:audio/wav;base64,UklGRiAAAAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YQgAAAA=" type="audio/wav"></audio>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
/* --- MAP INIT --- */
const map = L.map("map").setView([20,0],2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom:5 }).addTo(map);

/* --- GAME DATA --- */
let countryLookup = {}, aliasLookup = {}, guessedCountries = [], totalCountries = 0, xp=0, level=1;
let timerStarted = false, startTime, timerInterval;

/* --- ALIASES --- */
const aliases = {
    "united states of america":["usa","u.s.a","us","u.s","america"],
    "united kingdom":["uk","u.k","britain","england"],
    "russia":["russian federation"],
    "south korea":["korea","republic of korea","rok"],
    "north korea":["dprk","democratic people's republic of korea"],
    "china":["prc","people's republic of china"],
    "vatican city":["holy see"],
    "iran":["iran, islamic republic of"],
    "syria":["syrian arab republic"],
    "tanzania":["tanzania, united republic of"],
    "moldova":["republic of moldova"],
    "bolivia":["bolivia, plurinational state of"],
    "venezuela":["venezuela, bolivarian republic of"],
    "laos":["lao people's democratic republic"]
};

/* --- CONTINENTS --- */
const countryContinents = {
    "africa":["algeria","nigeria","egypt","tanzania","south africa"], 
    "asia":["china","india","japan","south korea","north korea","iran","syria"],
    "europe":["france","germany","russia","united kingdom","vatican city","moldova"],
    "north-america":["canada","united states of america","mexico"],
    "south-america":["brazil","argentina","venezuela","bolivia"],
    "oceania":["australia","new zealand"]
};

/* --- LOAD COUNTRIES --- */
fetch("https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json")
.then(res => res.json())
.then(data => {
    totalCountries = data.features.length;
    updateScore();
    L.geoJSON(data, {
        style:{color:"#444",weight:0.7,fillColor:"#1a1a1a",fillOpacity:0.5},
        onEachFeature: (feature, layer) => {
            const official = feature.properties.name.toLowerCase();
            countryLookup[official] = layer;
            if (aliases[official]){
                aliases[official].forEach(a => aliasLookup[a.toLowerCase()] = official);
            }
        }
    }).addTo(map);
});

/* --- INPUT HANDLER --- */
const input = document.getElementById("country-input");
input.addEventListener("keyup", () => {
    let guess = input.value.trim().toLowerCase();
    let officialGuess = aliasLookup[guess] || guess;
    if (!timerStarted && officialGuess) startTimer();
    if (countryLookup[officialGuess] && !guessedCountries.includes(officialGuess)){
        const layer = countryLookup[officialGuess];
        const geo = layer.getElement();
        if(geo){ geo.style.animation = "guessFlash 1s ease-out"; setTimeout(()=>geo.style.animation="",1000);}
        layer.setStyle({fillColor:"#28a745",fillOpacity:0.85});
        guessedCountries.push(officialGuess);
        addCountryToContinent(officialGuess);
        updateScore();
        gainXP(10);
        input.value = "";
        document.getElementById("sfx-correct").play();
        checkAchievements();
    }
});

/* --- ADD TO CONTINENT --- */
function addCountryToContinent(country){
    for(let cont in countryContinents){
        if(countryContinents[cont].includes(country)){
            const ul = document.getElementById(cont);
            const li = document.createElement("li");
            li.textContent = capitalize(country);
            ul.appendChild(li);
            break;
        }
    }
}
function capitalize(str){ return str.split(" ").map(w=>w[0].toUpperCase()+w.slice(1)).join(" "); }

/* --- UPDATE SCORE & STATS --- */
function updateScore(){
    document.getElementById("score").textContent = `${guessedCountries.length}/${totalCountries}`;
    document.getElementById("stat-correct").textContent = `Correct: ${guessedCountries.length}`;
    document.getElementById("stat-total").textContent = `Total: ${totalCountries}`;
    const acc = totalCountries? Math.round(guessedCountries.length/totalCountries*100):0;
    document.getElementById("stat-accuracy").textContent = `Accuracy: ${acc}%`;
}

/* --- XP & LEVEL --- */
function gainXP(amount){
    xp += amount;
    const bar = document.getElementById("xp-bar");
    if(xp>=100){ level++; xp=0; document.getElementById("level").textContent="Level "+level;}
    bar.style.width = xp+"%";
}

/* --- TIMER --- */
function startTimer(){
    timerStarted = true;
    startTime = Date.now();
    timerInterval = setInterval(()=> {
        const diff = Date.now() - startTime;
        const minutes = String(Math.floor(diff/60000)).padStart(2,'0');
        const seconds = String(Math.floor(diff/1000)%60).padStart(2,'0');
        document.getElementById("timer").textContent = minutes+":"+seconds;
    },1000);
}

/* --- ACHIEVEMENTS --- */
const achievements = [
    {name:"First Blood", condition:()=>guessedCountries.length>=1, unlocked:false},
    {name:"Explorer", condition:()=>guessedCountries.length>=10, unlocked:false},
    {name:"Globetrotter", condition:()=>guessedCountries.length>=20, unlocked:false}
];
function checkAchievements(){
    achievements.forEach(a=>{
        if(!a.unlocked && a.condition()){
            a.unlocked=true;
            showAchievement(a.name);
            document.getElementById("sfx-achievement").play();
        }
    });
}
function showAchievement(name){
    const popup = document.getElementById("achievement-popup");
    popup.textContent = "ðŸ† "+name;
    popup.classList.add("show");
    setTimeout(()=>popup.classList.remove("show"),3000);
}
</script>
</body>
</html>
