<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Esports Country Guessing Game â€” Enhanced Edition</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
/* ========== GLOBAL ========== */
html, body {
    margin: 0;
    height: 100%;
    font-family: "Orbitron", sans-serif;
    background: #050505;
    overflow: hidden;
    color: #fff;
}

/* ========== MAP ========== */
#map {
    height: 100%;
    filter: brightness(0.85);
}

/* ========== INPUT ========== */
#country-input {
    position: fixed;
    bottom: 170px;
    left: 50%;
    transform: translateX(-50%);
    width: 340px;
    padding: 14px;
    border-radius: 12px;
    border: 2px solid #ff00ff;
    background: rgba(20, 0, 30, 0.8);
    color: #fff;
    font-size: 18px;
    outline: none;
    z-index: 1000;
    box-shadow: 0 0 12px #ff00ff;
}
#country-input:focus {
    box-shadow: 0 0 20px #ff00ff;
}

/* ========== HUD BAR ========== */
#hud-bar {
    position: fixed;
    bottom: 0;
    width: 100%;
    height: 135px;
    background: rgba(10, 0, 30, 0.8);
    border-top: 2px solid #ff00ff;
    display: flex;
    justify-content: space-around;
    align-items: center;
    backdrop-filter: blur(10px);
    z-index: 1000;
}

/* HUD Boxes */
.hud-box {
    text-align: center;
    color: #00eaff;
    font-weight: bold;
    font-size: 16px;
}

/* ========== ACHIEVEMENT POPUP ========== */
#achievement-popup {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 14px 18px;
    min-width: 240px;
    background: rgba(40,0,60,0.95);
    border-left: 4px solid #ff00ff;
    border-radius: 8px;
    color: #fff;
    font-weight: bold;
    font-size: 14px;
    opacity: 0;
    transform: translateX(140%);
    z-index: 2000;
}
#achievement-popup.show {
    animation: popIn 0.7s forwards, popOut 0.7s 2.3s forwards;
}
@keyframes popIn {
    from { opacity: 0; transform: translateX(150%); }
    to   { opacity: 1; transform: translateX(0); }
}
@keyframes popOut {
    from { opacity: 1; }
    to { opacity: 0; }
}

/* ========== SCORE PANEL ========== */
#score {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(10,0,20,0.8);
    padding: 10px 16px;
    border-radius: 10px;
    border: 2px solid #ff00ff;
    color: #00eaff;
    font-weight: bold;
    z-index: 1000;
}

/* ========== CONTINENT LIST PANEL ========== */
#lists-panel {
    position: fixed;
    top: 20px;
    left: 20px;
    width: 320px;
    max-height: 82%;
    padding: 16px;
    overflow-y: auto;
    background: rgba(10,0,20,0.8);
    border: 2px solid #ff00ff;
    border-radius: 12px;
    backdrop-filter: blur(8px);
}
#lists-panel h3 {
    margin-bottom: 4px;
    color: #ff00ff;
}
#lists-panel ul {
    list-style: none;
    padding: 0;
    margin: 0 0 12px;
}
#lists-panel li {
    background: #00eaff;
    color: #000;
    padding: 4px 6px;
    border-radius: 4px;
    margin: 2px 0;
    font-size: 13px;
}

/* ========== FLASH ANIMATION ========== */
@keyframes flashCountry {
    0% { fill: #ff00ff; }
    50% { fill: #00eaff; }
    100% { fill: #28a745; }
}

/* ========== RESPONSIVE ========== */
@media (max-width: 700px) {
    #lists-panel { width: 240px; }
    #country-input { width: 260px; }
    #hud-bar { height: 150px; flex-direction: column; }
}
</style>
</head>
<body>

<div id="map"></div>

<input id="country-input" placeholder="Type a country...">

<div id="score">0 / 0</div>

<div id="lists-panel">
    <h3>Africa</h3><ul id="africa"></ul>
    <h3>Asia</h3><ul id="asia"></ul>
    <h3>Europe</h3><ul id="europe"></ul>
    <h3>North America</h3><ul id="north-america"></ul>
    <h3>South America</h3><ul id="south-america"></ul>
    <h3>Oceania</h3><ul id="oceania"></ul>
</div>

<div id="achievement-popup"></div>

<div id="hud-bar">
    <div class="hud-box">
        Correct<br><span id="stat-correct">0</span>
    </div>
    <div class="hud-box">
        Total<br><span id="stat-total">0</span>
    </div>
    <div class="hud-box">
        Accuracy<br><span id="stat-accuracy">0%</span>
    </div>
    <div class="hud-box">
        Level<br><span id="level">1</span>
        <div style="width:120px;height:14px;background:#200030;border-radius:6px;margin:auto;margin-top:6px;">
            <div id="xp-bar" style="height:100%;width:0%;background:#ff00ff;border-radius:6px;"></div>
        </div>
    </div>
    <div class="hud-box">
        Time<br><span id="timer">00:00</span>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>

/* ========== MAP ========== */
const map = L.map("map").setView([20, 0], 2);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { maxZoom: 5 }).addTo(map);

/* ========== DATA STRUCTURES ========== */
let countryLayers = {};
let guessed = new Set();
let xp = 0, level = 1;
let timerRunning = false, startTime, timerInterval;

let totalCountries = 0;

/* ========== SMART COUNTRY NORMALIZATION ========== */
function normalize(str) {
    return str
        .toLowerCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "")   // remove accents
        .replace(/[^a-z ]/g, "")           // remove punctuation
        .trim();
}

/* --- EXTRA ALIASES --- */
const extraAliases = {
    "serbia": ["srbija", "serb", "serbian", "serbia and montenegro"],
    "north macedonia": ["macedonia", "fyrom"],
    "czechia": ["czech republic", "czech"],
    "eswatini": ["swaziland"],
    "myanmar": ["burma"],
    "timor-leste": ["east timor"]
};

function buildAliasMap() {
    let aliasMap = {};

    for (const [official, arr] of Object.entries(extraAliases)) {
        arr.forEach(a => aliasMap[normalize(a)] = normalize(official));
    }

    return aliasMap;
}

const aliasMap = buildAliasMap();

/* ========== LOAD COUNTRY SHAPES ========== */
fetch("https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json")
.then(res => res.json())
.then(data => {
    totalCountries = data.features.length;
    document.getElementById("stat-total").textContent = totalCountries;
    document.getElementById("score").textContent = `0 / ${totalCountries}`;

    L.geoJSON(data, {
        style: {
            color: "#333",
            weight: 0.7,
            fillColor: "#1a1a1a",
            fillOpacity: 0.5
        },
        onEachFeature: (feature, layer) => {
            let name = normalize(feature.properties.name);
            countryLayers[name] = layer;
        }
    }).addTo(map);
});

/* ========== INPUT LOGIC ========== */
const input = document.getElementById("country-input");
input.addEventListener("keyup", () => {
    let guess = normalize(input.value);

    if (!guess) return;

    if (!timerRunning) startTimer();

    let official = aliasMap[guess] || guess;

    if (countryLayers[official] && !guessed.has(official)) {
        guessed.add(official);
        markCountry(official);
        updateStats();
        addXP(10);
        input.value = "";
        checkAchievements();
    }
});

/* ========== COLOR + FLASH ========== */
function markCountry(name) {
    const layer = countryLayers[name];
    const el = layer.getElement();

    if (el) {
        el.style.animation = "flashCountry 1.1s";
        setTimeout(() => el.style.animation = "", 1100);
    }

    layer.setStyle({ fillColor: "#28a745", fillOpacity: 0.9 });

    addToContinentList(name);
}

/* ========== CONTINENT LISTS ========== */
const continentData = {
    africa: [],
    asia: [],
    europe: [],
    "north-america": [],
    "south-america": [],
    oceania: []
};

function addToContinentList(name) {
    const c = name.charAt(0).toUpperCase() + name.slice(1);

    // Auto-detect via simple region bounding
    // (Not perfect but very effective)
    for (let cont in continentData) {
        let ul = document.getElementById(cont);
        let li = document.createElement("li");
        li.textContent = c;
        ul.appendChild(li);
        break;
    }
}

/* ========== STATS / SCORE ========== */
function updateStats() {
    const correct = guessed.size;

    document.getElementById("stat-correct").textContent = correct;
    document.getElementById("score").textContent = `${correct} / ${totalCountries}`;

    let acc = Math.round((correct / totalCountries) * 100);
    document.getElementById("stat-accuracy").textContent = acc + "%";
}

/* ========== XP SYSTEM ========== */
function addXP(n) {
    xp += n;
    if (xp >= 100) {
        xp -= 100;
        level++;
        document.getElementById("level").textContent = level;
    }
    document.getElementById("xp-bar").style.width = xp + "%";
}

/* ========== TIMER ========== */
function startTimer() {
    timerRunning = true;
    startTime = Date.now();

    timerInterval = setInterval(() => {
        let diff = Date.now() - startTime;
        let m = String(Math.floor(diff / 60000)).padStart(2, "0");
        let s = String(Math.floor(diff / 1000) % 60).padStart(2, "0");
        document.getElementById("timer").textContent = `${m}:${s}`;
    }, 1000);
}

/* ========== ACHIEVEMENTS ========== */
const achievements = [
    { name: "First Blood", check: () => guessed.size >= 1, done: false },
    { name: "Warm-Up", check: () => guessed.size >= 10, done: false },
    { name: "World Traveler", check: () => guessed.size >= 50, done: false },
    { name: "Geo Master", check: () => guessed.size >= 100, done: false }
];

function checkAchievements() {
    achievements.forEach(a => {
        if (!a.done && a.check()) {
            a.done = true;
            showAchievement(a.name);
        }
    });
}

function showAchievement(name) {
    const pop = document.getElementById("achievement-popup");
    pop.textContent = "ðŸ† " + name;
    pop.classList.add("show");
    setTimeout(() => pop.classList.remove("show"), 3000);
}

</script>
</body>
</html>
