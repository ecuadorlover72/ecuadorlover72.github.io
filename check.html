<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Roblox User Lookup</title>
<style>
  body{font-family:sans-serif;margin:20px;}
  input,button{padding:5px;margin:5px;}
  .card{border:1px solid #ccc;padding:10px;margin:10px 0;border-radius:5px;}
  .tag{background:#eee;padding:2px 5px;margin-right:5px;border-radius:3px;}
  img.avatar{width:100px;height:100px;border-radius:50%;}
</style>
</head>
<body>

<h2>Roblox User Lookup</h2>
<input id="rbxUser" placeholder="Enter username">
<button id="rbxFetch">Fetch Account Data</button>

<div id="rbxResults"></div>

<script>
// ---------------- CORS Proxy ----------------
const CORS_PROXY = 'https://api.allorigins.win/raw?url=';

async function fetchJson(url, opts){
  const res = await fetch(CORS_PROXY + encodeURIComponent(url), opts);
  if(!res.ok) throw new Error(`HTTP ${res.status}`);
  return res.json();
}

// ---------------- Roblox API Functions ----------------
async function lookupUser(name){
  const url = 'https://users.roproxy.com/v1/usernames/users';
  const payload = { usernames: [name], excludeBannedUsers: false };
  const data = await fetchJson(url, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(payload)
  });
  if(data?.data?.length) return data.data[0];
  throw new Error('User not found.');
}

async function getUserProfile(id){
  return await fetchJson(`https://users.roproxy.com/v1/users/${id}`);
}

async function getUserFriends(id){
  const data = await fetchJson(`https://friends.roproxy.com/v1/users/${id}/friends?limit=200`);
  return data?.data || [];
}

async function getUserGroups(id){
  const data = await fetchJson(`https://groups.roproxy.com/v2/users/${id}/groups/roles`);
  return data?.data || [];
}

async function getUserBadges(id){
  const data = await fetchJson(`https://badges.roproxy.com/v1/users/${id}/badges?limit=100`);
  return data?.data || [];
}

// ---------------- Main ----------------
const rbxInput = document.getElementById('rbxUser');
const rbxResults = document.getElementById('rbxResults');

document.getElementById('rbxFetch').onclick = () => renderProfile(rbxInput.value.trim());

async function renderProfile(username){
  if(!username) return;
  rbxResults.innerHTML = `<div class="card">Loading profile for <b>${username}</b>...</div>`;

  try{
    const user = await lookupUser(username);
    const id = user.id;
    const profile = await getUserProfile(id);

    const avatarUrl = `https://www.roblox.com/headshot-thumbnail/image?userId=${id}&width=150&height=150&format=png`;

    const friendsList = (await getUserFriends(id)).map(f => f.name);
    const groupsList = (await getUserGroups(id)).map(g => `${g.group.name} â€” ${g.role?.name||'Member'}`);
    const badgeList = (await getUserBadges(id)).map(b => b.name);

    rbxResults.innerHTML = '';
    function makeCard(title, body, list){ 
      const c = document.createElement('div');
      c.className='card';
      c.innerHTML=`<h3>${title}</h3>${body}`;
      if(list && list.length) c.innerHTML += `<p>Preview: ${list.slice(0,5).join(', ')}${list.length>5?'...':''}</p>`;
      rbxResults.appendChild(c);
    }

    makeCard('Profile', `
      <img class="avatar" src="${avatarUrl}" alt="Avatar"><br>
      <span class="tag">ID: ${id}</span><br>
      <b>${profile.displayName}</b><br>@${profile.name}<br>
      Created: ${profile.created ? new Date(profile.created).toLocaleDateString() : 'Unknown'}<br>
      Description: <span class="small">${profile.description || '(none)'}</span>
    `);

    makeCard('Friends', friendsList.slice(0,6).join(', ') || 'None', friendsList);
    makeCard('Groups', groupsList.slice(0,5).join('<br>') || 'None', groupsList);
    makeCard('Badges', badgeList.slice(0,5).join(', ') || 'None', badgeList);

  } catch(err) {
    rbxResults.innerHTML = `<div class="card"><h3>Error</h3><p>${err.message}</p></div>`;
  }
}
</script>

</body>
</html>
