<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Capital Conquest</title>
<style>
body{margin:0;background:#0d1117;color:white;font-family:system-ui}
canvas{display:block;margin:auto;border:1px solid #222}
#ui{display:flex;justify-content:center;gap:10px;padding:10px}
.card{background:#161b22;padding:10px;border-radius:12px;font-size:13px;min-width:150px}
button{margin:3px;padding:6px 10px;border:none;border-radius:8px;cursor:pointer}
.green{background:#238636;color:white}
.red{background:#b91c1c;color:white}
.gray{background:#30363d;color:white}
#panel{text-align:center}
</style>
</head>
<body>

<div id="ui">
  <div class="card" id="playerCard"></div>
  <div class="card" id="nationCard"></div>
</div>

<canvas id="map" width="900" height="450"></canvas>

<div id="panel">
  <select id="nationSelect"></select><br>
  <button class="red" onclick="declareWar()">Declare War</button>
  <button class="green" onclick="makeAlliance('military')">Military Alliance</button>
  <button class="green" onclick="makeAlliance('economic')">Economic Alliance</button>
  <button class="gray" onclick="breakAlliance()">Break Alliance</button><br><br>
  <button onclick="attack()">Attack</button>
</div>

<script>
const c=document.getElementById("map"),ctx=c.getContext("2d");

const player={name:"Player",army:30,money:30,allies:[]};
const nations=[
 {name:"Red Dominion",army:25,money:20,color:"rgba(220,60,60,.35)",capital:{x:780,y:100},status:"neutral"},
 {name:"Green Pact",army:20,money:25,color:"rgba(60,220,120,.35)",capital:{x:780,y:350},status:"neutral"},
 {name:"Iron State",army:35,money:15,color:"rgba(180,180,180,.35)",capital:{x:450,y:50},status:"neutral"}
];

const blueCap={x:120,y:225};
let units=[];
let borderX=450;
let target=null;

function init(){
  const sel=document.getElementById("nationSelect");
  sel.innerHTML="";
  nations.forEach((n,i)=>{
    const o=document.createElement("option");
    o.value=i;o.text=n.name;sel.appendChild(o);
  });
  updateUI();
  animate();
}

function declareWar(){
  target=nations[nationSelect.value];
  target.status="war";
  updateUI();
}

function makeAlliance(type){
  const n=nations[nationSelect.value];
  if(n.status==="allied") return;
  n.status="allied";
  n.allianceType=type;
  player.allies.push(n);
  updateUI();
}

function breakAlliance(){
  const n=nations[nationSelect.value];
  n.status="neutral";
  player.allies=player.allies.filter(a=>a!==n);
  updateUI();
}

function attack(){
  if(!target||target.status!=="war") return;

  spawnUnits(player,blueCap,{x:borderX,y:225},player.army*0.2,"blue");

  player.allies.forEach(a=>{
    if(a.allianceType==="military"){
      spawnUnits(a,a.capital,{x:borderX,y:225},a.army*0.15,"cyan");
    }
    if(a.allianceType==="economic"){
      player.money+=5;
    }
  });

  if(Math.random()<player.army/(player.army+target.army)){
    borderX+=25;
    target.army-=5;
  }else{
    borderX-=20;
    player.army-=4;
  }

  checkWin();
}

function spawnUnits(owner,from,to,count,color){
  for(let i=0;i<count;i++){
    units.push({
      x:from.x,y:from.y,
      tx:to.x+Math.random()*20-10,
      ty:to.y+Math.random()*20-10,
      color
    });
  }
}

function animate(){
  ctx.clearRect(0,0,900,450);

  // earth-like background
  for(let i=0;i<900;i+=6)
    for(let j=0;j<450;j+=6){
      ctx.fillStyle=`rgb(30,${80+Math.random()*30},40)`;
      ctx.fillRect(i,j,6,6);
    }

  // territories
  ctx.fillStyle="rgba(60,100,220,.35)";
  ctx.fillRect(0,0,borderX,450);
  ctx.fillStyle="rgba(220,60,60,.35)";
  ctx.fillRect(borderX,0,900-borderX,450);

  // capitals
  drawDot(blueCap.x,blueCap.y,"yellow",8);
  nations.forEach(n=>drawDot(n.capital.x,n.capital.y,"yellow",7));

  // units animation
  units.forEach(u=>{
    u.x+=(u.tx-u.x)*0.05;
    u.y+=(u.ty-u.y)*0.05;
    drawDot(u.x,u.y,u.color,3);
  });

  units=units.filter(u=>Math.hypot(u.tx-u.x,u.ty-u.y)>2);

  updateUI();
  requestAnimationFrame(animate);
}

function drawDot(x,y,c,r){
  ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2);
  ctx.fillStyle=c;
  ctx.fill();
}

function updateUI(){
  playerCard.innerText=`${player.name}\nArmy:${player.army}\nMoney:${player.money}\nAllies:${player.allies.length}`;
  const n=nations[nationSelect.value];
  nationCard.innerText=`${n.name}\nArmy:${n.army}\nStatus:${n.status}\nAlliance:${n.allianceType||"-"}`;
}

function checkWin(){
  if(borderX>=780) alert("You win the war!");
  if(borderX<=120) alert("You lost the war!");
}

init();
</script>
</body>
</html>
