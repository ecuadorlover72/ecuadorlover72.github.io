<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Breakpoint Shift Prototype</title>
<style>
    body {
        margin: 0;
        background: #0b0f1a;
        overflow: hidden;
        font-family: sans-serif;
        color: white;
    }

    canvas {
        background: #141821;
        display: block;
        margin: 0 auto;
        border: 2px solid #222;
    }

    #info {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0,0,0,0.4);
        padding: 10px 15px;
        border-radius: 6px;
        font-size: 14px;
    }
</style>
</head>
<body>
<div id="info">
    <strong>Breakpoint Shift – Prototype</strong><br>
    Arrow keys to move • Space to jump<br>
    Each jump rotates the sector<br>
</div>

<canvas id="game" width="800" height="600"></canvas>

<script>
/* ==========================================================
   BREAKPOINT SHIFT — PROTOTYPE ENGINE
   ----------------------------------------------------------
   Core Features Implemented:
   ✔ Player movement & jumping
   ✔ Sectors with rotation logic
   ✔ Rotation types: normal, heavy, free, reverse, chaotic
   ✔ Jump-limited rotation & counters
   ========================================================== */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ----------------------------------------------------------
// PLAYER
// ----------------------------------------------------------
const player = {
    x: 380,
    y: 300,
    w: 30, h: 30,
    vx: 0,
    vy: 0,
    grounded: false,
    jumps: 0
};

// ----------------------------------------------------------
// SECTOR LOGIC
// ----------------------------------------------------------
class Sector {
    constructor(x, y, size, type="normal") {
        this.x = x;
        this.y = y;
        this.size = size;
        this.type = type;

        this.angle = 0;
        this.jumpCounter = 0;
        this.heavyThreshold = 2; // heavy sectors rotate every 2 jumps
    }

    onPlayerJump() {
        this.jumpCounter++;

        switch (this.type) {

            case "normal":
                this.rotate90();
                break;

            case "heavy":
                if (this.jumpCounter >= this.heavyThreshold) {
                    this.rotate90();
                    this.jumpCounter = 0;
                }
                break;

            case "free":
                // Only rotates if a switch triggers it (not implemented)
                break;

            case "reverse":
                this.rotate90(false); // CCW rotation
                break;

            case "chaotic":
                this.rotateChaos();
                break;

            default:
                break;
        }
    }

    rotate90(clockwise = true) {
        this.angle += clockwise ? 90 : -90;
    }

    rotateChaos() {
        const angles = [90, -90, 180, 270];
        const pick = angles[Math.floor(Math.random()*angles.length)];
        this.angle += pick;
    }

    draw() {
        ctx.save();
        ctx.translate(this.x + this.size/2, this.y + this.size/2);
        ctx.rotate((this.angle * Math.PI)/180);

        // Draw sector boundary
        ctx.strokeStyle = "#1fd2f3";
        ctx.lineWidth = 3;
        ctx.strokeRect(-this.size/2, -this.size/2, this.size, this.size);

        // Draw type label
        ctx.fillStyle = "#1fd2f3";
        ctx.font = "14px sans-serif";
        ctx.fillText(this.type, -this.size/2 + 5, -this.size/2 + 18);

        ctx.restore();
    }

    contains(px, py) {
        return px > this.x && px < this.x + this.size &&
               py > this.y && py < this.y + this.size;
    }
}

// ----------------------------------------------------------
// CREATE SECTORS
// ----------------------------------------------------------
const sectors = [
    new Sector(100, 100, 200, "normal"),
    new Sector(350, 100, 200, "heavy"),
    new Sector(100, 350, 200, "reverse"),
    new Sector(350, 350, 200, "chaotic")
];

// ----------------------------------------------------------
// INPUT
// ----------------------------------------------------------
const keys = {};
document.addEventListener("keydown", e => {
    keys[e.code] = true;

    if (e.code === "Space" && player.grounded) {
        player.vy = -12;
        player.grounded = false;
        handleJumpRotation();
    }
});

document.addEventListener("keyup", e => keys[e.code] = false);

// ----------------------------------------------------------
// JUMP → ROTATE SECTOR
// ----------------------------------------------------------
function handleJumpRotation() {
    for (const s of sectors) {
        if (s.contains(player.x + player.w/2, player.y + player.h/2)) {
            s.onPlayerJump();
            break;
        }
    }
}

// ----------------------------------------------------------
// GAME LOOP
// ----------------------------------------------------------
function update() {
    // Movement
    if (keys["ArrowLeft"]) player.vx = -4;
    else if (keys["ArrowRight"]) player.vx = 4;
    else player.vx = 0;

    player.vy += 0.5; // gravity

    // Apply movement
    player.x += player.vx;
    player.y += player.vy;

    // Simple ground plane
    if (player.y + player.h > 580) {
        player.y = 580 - player.h;
        player.vy = 0;
        player.grounded = true;
    }

    draw();
    requestAnimationFrame(update);
}

// ----------------------------------------------------------
// DRAW EVERYTHING
// ----------------------------------------------------------
function draw() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Draw sectors
    for (const s of sectors) s.draw();

    // Draw player
    ctx.fillStyle = "#ff854c";
    ctx.fillRect(player.x, player.y, player.w, player.h);
}

update();
</script>
</body>
</html>
